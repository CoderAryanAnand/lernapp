{% extends "base.html" %}

{% block title %}Passwort ändern - KantiKoala{% endblock %}

{% block meta %}
<!--
    CSRF token meta tag for AJAX requests and form security.
    Ensures secure POST operations from JavaScript or forms.
-->
<meta name="csrf-token" content="{{ session.get('csrf_token', '') }}">
{% endblock %}

{% block content %}
<!--
    Change Password Page
    - Allows the user to change their password securely.
    - Displays flash messages for errors and success.
    - Uses Tailwind CSS for styling and supports dark mode.
-->
<div class="max-w-md mx-auto">
    <!-- Page Heading -->
    <h1 class="text-3xl sm:text-4xl font-bold text-zinc-800 dark:text-white mb-8">Passwort ändern</h1>

    <!-- Flash Messages for error/success/info -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-6">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }} p-4 rounded-lg mb-3 
                        {% if category == 'error' %}
                            bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 border border-red-300 dark:border-red-700
                        {% else %}
                            bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 border border-green-300 dark:border-green-700
                        {% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Change Password Form -->
    <form method="POST" class="p-6 bg-white dark:bg-zinc-800 rounded-xl shadow-md border border-zinc-200 dark:border-zinc-700">
        <!-- CSRF token for form security -->
        <input type="hidden" name="csrf_token" value="{{ session.get('csrf_token', '') }}">
        
        <!-- Old Password Field -->
        <div class="mb-4">
            <label for="ogpw" class="block text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-2">Altes Passwort</label>
            <input type="password" id="ogpw" name="ogpw" required 
                   class="w-full px-4 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- New Password Field -->
        <div class="mb-4">
            <label for="newpw" class="block text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-2">Neues Passwort</label>
            <input type="password" id="newpw" name="newpw" required 
                   class="w-full px-4 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Confirm New Password Field -->
        <div class="mb-6">
            <label for="confirm" class="block text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-2">Passwort bestätigen</label>
            <input type="password" id="confirm" name="confirm" required 
                   class="w-full px-4 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-700 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Submit Button -->
        <button type="submit" 
                class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-zinc-900">
            Passwort ändern
        </button>
    </form>

    <!-- Link to return to settings page -->
    <div class="mt-4 text-center">
        <a href="{{ url_for('settings.settings_view') }}" class="text-blue-600 hover:underline dark:text-blue-400">Zurück zu den Einstellungen</a>
    </div>
</div>
{% endblock %}